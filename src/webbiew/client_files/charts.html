<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>MATT WebView</title>

		<!-- Bootstrap -->
		<link href="deps/bootstrap/css/bootstrap.min.css" rel="stylesheet">
		<!-- Theme -->
		<link href='deps/bootswatch/slate/bootstrap.min.css' rel="stylesheet">
		
		<!--[if lt IE 9]><script language="javascript" type="text/javascript" src="excanvas.js"></script><![endif]-->
		<script src="deps/jquery/jquery.min.js"></script>
		<script language="javascript" type="text/javascript" src="deps/jqplot/jquery.jqplot.min.js"></script>
		<script language="javascript" type="text/javascript" src="deps/jqplot/plugins/jqplot.enhancedLegendRenderer.min.js"></script>
		<script language="javascript" type="text/javascript" src="deps/jqplot/plugins/jqplot.highlighter.min.js"></script>
		<link rel="stylesheet" type="text/css" href="deps/jqplot/jquery.jqplot.css" />

		<style type="text/css" media="screen">
			#matt-editor { 
	/*                      position: absolute; */
	/*                      top: 0; */
					right: 0;
	/*                      bottom: 0; */
					left: 0;
					height:600px;
					width:100%;
			}
		</style>

		<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
		<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
		<!--[if lt IE 9]>
		<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
		<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
		<![endif]-->
	</head>
	<body>
		<h1> .</h1>

		<!-- Include all compiled plugins (below), or include individual files as needed -->
		<script src="deps/bootstrap/js/bootstrap.min.js"></script>
		<!-- EJS system to apply code temples. -->
		<script src="deps/ejs/ejs_production.js"></script>
		<!-- ACE editor -->
		<script src="/deps/ace/src-noconflict/ace.js"></script>
		<script src="/deps/ace/src-noconflict/mode-c_cpp.js"></script>
		<!-- MATT functions for func list -->
		<script type='text/javascript' src='./helper.js'></script>
		<script type='text/javascript' src='./func-list.js'></script>

		<!-- Top NAV bar -->
		<div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
			<div class="container-fluid">
				<div class="navbar-header">
					<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
						<span class="sr-only">Toggle navigation</span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</button>
					<a class="navbar-brand" href="#">MATT WebView</a>
					</div>
					<div class="navbar-collapse collapse">
					<ul class="nav navbar-nav navbar-right">
						<li><a href="#">Summary</a></li>
						<li><a href="index.html">Stack analysis</a></li>
						<li><a href="charts.html">Charts</a></li>
						<li><a href="#">Help</a></li>
					</ul>
					<!--<form class="navbar-form navbar-right">
						<input type="text" class="form-control" placeholder="Search...">
					</form>-->
				</div>
			</div>
		</div>
		
		<div class="container-fluid">
			<div class="row">
				<div class="col-sm-12 col-md-12 main">
					<div id='matt-plot' style="height:400px;width:90%;margin-left:auto;margin-right:auto;">
					</div>
					<div id='matt-plot2' style="height:400px;width:90%;margin-left:auto;margin-right:auto;">
					</div>
				</div>
			</div>
		</div>
		
		<script type='text/javascript'>
			function mattConvertDataInternal(data)
			{
				var res = new Array();
				for (var i = 0 ; i < data.timestamp.length ; i++)
				{
					res[i] = [data.timestamp[i],data.max[i]];
				}
				return res;
			}
		
			function mattConvertData(data)
			{
				var res = new Array();
				res.push( mattConvertDataInternal(data.virtualMem) );
				res.push( mattConvertDataInternal(data.physicalMem) );
				res.push( mattConvertDataInternal(data.requestedMem) );
				res.push( mattConvertDataInternal(data.internalMem) );
				var labels = new Array();
				labels.push("Virtuel memory");
				labels.push("Physical memory");
				labels.push("Requested memory");
				labels.push("Internal memory");
				return {data:res,labels:labels};
			}
			
			function mattConvertCnt(data)
			{
				var res = new Array();
				res.push( mattConvertDataInternal(data.segments) );
				var labels = new Array();
				labels.push("Memory segments");
				return {data:res,labels:labels};
			}
		
			function mattUpdatePlot(id,title,data,unit)
			{			
				var plot = $.jqplot(id, data.data, {
					title: title,
					stackSeries: false,
					seriesDefaults: {
						showMarker: false,
						fill: true,
						fillAndStroke: true
					},
					legend: {
						show: true,
						placement: 'outsideGrid',
						renderer: $.jqplot.EnhancedLegendRenderer,
						labels: data.labels,
						location: 'ne',
						rowSpacing: '0px'
					},
					axesDefaults: {
						labelRenderer: $.jqplot.CanvasAxisLabelRenderer
					},
					cursor:{
						show: true,
						zoom:true,
						showTooltip:true
					} ,
					axes: {
						xaxis: {
							pad: 0,
// 							ticks: ticks,
							label: 'Time',
							tickOptions: {
								showGridline: false,
								formatter: function(format,value) {return mattHumanReadableValue(value,'');}
							}
						},
						yaxis: {
							min: 0,
							label: 'Memory',
							tickOptions: {
							showGridline: false,
							formatter: function(format,value) {return mattHumanReadableValue(value,unit);}
							}
						}
					},
					grid: {
						drawGridLines: true, 
						gridLineColor: '#cccccc',
						background: '#464D56',
						borderColor: '#999999',
						drawBorder: false,
						shadow: false,
						renderer: $.jqplot.CanvasGridRenderer,
						// background: 'rgba(0,0,0,0)'  works to make transparent.
// 						background: 'white'
					}
				});
				
				var d = new $.jsDate();
				$('div.jqplot-datestamp').html('Generated on '+d.strftime('%v'));
				
// 				$("div.chart-container").resizable({delay:20});
				$('div.chart-container').bind('resize', function(event, ui) {
					plot.replot();
				});
				
				 $('#matt-plot').bind('jqplotDataHighlight', function(ev, seriesIndex, pointIndex, data) {
					var idx = 21 - seriesIndex
					$('tr.jqplot-table-legend').removeClass('legend-row-highlighted'); 
					$('tr.jqplot-table-legend').children('.jqplot-table-legend-label').removeClass('legend-text-highlighted');
					$('tr.jqplot-table-legend').eq(idx).addClass('legend-row-highlighted');
					$('tr.jqplot-table-legend').eq(idx).children('.jqplot-table-legend-label').addClass('legend-text-highlighted');
				});
			
				$('#matt-plot').bind('jqplotDataUnhighlight', function(ev, seriesIndex, pointIndex, data) {
					$('tr.jqplot-table-legend').removeClass('legend-row-highlighted'); 
					$('tr.jqplot-table-legend').children('.jqplot-table-legend-label').removeClass('legend-text-highlighted');
				});
			}
		
			$( document ).ready(function() {
				$.getJSON( "timed.json", function( data ) {
					mattUpdatePlot('matt-plot','Memory',mattConvertData(data),'B');
					mattUpdatePlot('matt-plot2','Allocated segments',mattConvertCnt(data),'');
				});
			});
		</script>
	</body>
</html>
