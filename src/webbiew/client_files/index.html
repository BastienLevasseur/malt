<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>MATT WebView</title>

		<!-- Bootstrap -->
		<link href="deps/bootstrap/css/bootstrap.min.css" rel="stylesheet">
		<!-- Theme -->
		<link href='deps/bootswatch/slate/bootstrap.min.css' rel="stylesheet">

		<style type="text/css" media="screen">
			#matt-editor { 
	/*                      position: absolute; */
	/*                      top: 0; */
					right: 0;
	/*                      bottom: 0; */
					left: 0;
					height:600px;
					width:100%;
			}
		</style>

		<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
		<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
		<!--[if lt IE 9]>
		<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
		<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
		<![endif]-->
	</head>
	<body>
		<h1> .</h1>

		<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
		<script src="deps/jquery/jquery.min.js"></script>
		<!-- Include all compiled plugins (below), or include individual files as needed -->
		<script src="deps/bootstrap/js/bootstrap.min.js"></script>
		<!-- EJS system to apply code temples. -->
		<script src="deps/ejs/ejs_production.js"></script>
		<!-- ACE editor -->
		<script src="/deps/ace/src-noconflict/ace.js"></script>
		<script src="/deps/ace/src-noconflict/mode-c_cpp.js"></script>
		<!-- MATT functions for func list -->
		<script type='text/javascript' src='./func-list.js'></script>

		<!-- Top NAV bar -->
		<div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
			<div class="container-fluid">
				<div class="navbar-header">
					<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
						<span class="sr-only">Toggle navigation</span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</button>
					<a class="navbar-brand" href="#">MATT WebView</a>
					</div>
					<div class="navbar-collapse collapse">
					<ul class="nav navbar-nav navbar-right">
						<li><a href="#">Summary</a></li>
						<li><a href="index.html">Stack analysis</a></li>
						<li><a href="charts.html">Charts</a></li>
						<li><a href="#">Help</a></li>
					</ul>
					<!--<form class="navbar-form navbar-right">
						<input type="text" class="form-control" placeholder="Search...">
					</form>-->
				</div>
			</div>
		</div>
		
		<div class="container-fluid">
			<div class="row">
				<div class="col-sm-5 col-md-4 col-lg-3 sidebar">
					<div class="btn-group">
						<button type="button" class="btn btn-default" onclick="javascript:document.getElementById('matt-func-list').matt.toogleSort();"><span class='glyphicon glyphicon-sort'/> </button>
						<button type="button" class="btn btn-default" onclick="javascript:document.getElementById('matt-func-list').matt.toogleUnit();"><b>%</b></button>
						<button type="button" class="btn btn-default" onclick="javascript:document.getElementById('matt-func-list').matt.toogleMode();"><b>I</b></button>
						<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
							Allocated mem.
							<span class="caret"></span>
						</button>
						<ul class="dropdown-menu" id='matt-selector-list'>
							<!--<li><a href="javascript:document.getElementById('matt-func-list').matt.updateMatric('alloc.count');">Alloc num.</a></li>-->
						</ul>
					</div>
				
					<ul class="nav nav-sidebar" id='matt-func-list'>
					</ul>
				</div>
				<div class="col-sm-7 col-md-8 col-lg-9 main">
					<div id='matt-editor'>
					//no selected sources
					</div>
				</div>
			</div>
		</div>
		
		<script type='text/javascript'>
			function MattEditor(divId)
			{
				//store divid
				this.divId = divId;
				this.div = document.getElementById(divId);
				this.div.matt = this;
				
				//create editor
				this.editor = ace.edit(divId);
				this.editor.setTheme("ace/theme/tomorrow_night");
				this.editor.getSession().setMode("ace/mode/c_cpp");
				this.editor.setReadOnly(true);
				
				//cur file name
				this.file = null;

				//Function to update file in editor
				this.updateFile = function(file,line)
				{
					///trivial
					if (file == this.file)
					{
						this.editor.gotoLine(line);
						return;
					}
				
					//check if need to load file or if unknown
					if(file == '??' || file == '' || file == undefined)
					{
						this.editor.setValue("//Uknown source file, maybe debug informations are missing !\n");
						this.editor.resize(true);
						this.editor.gotoLine(1);
						this.file = null;
					} else {
						var mattObj = this;
						$.get( "/app-sources/"+file,function(data){
							mattObj.editor.setValue(data);
							mattObj.editor.resize(true);
							mattObj.editor.gotoLine(line);
							mattObj.file = file;
						});
					}
				}
				
// 				this.updateFile('/home/svalat/Projects/matt/src/tests/simple-case.cpp');
			}
		
			$( document ).ready(function() {
				var mattFuncList = new MattFuncList('matt-func-list');
				mattFuncList.renderSelectorList('matt-selector-list');
				var mattEditor = new MattEditor('matt-editor');
			});
		</script>
	</body>
</html>
