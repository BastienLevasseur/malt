<% layout('page-layout') -%>
<% script('stack-analysis/flat-func-list.js') -%>
<% script('stack-analysis/source-editor.js') -%>
<% script('deps/d3js/d3.min.js') -%>

<% script('deps/jquery-treetable/javascripts/src/jquery.treetable.js') -%>
<% stylesheet('deps/jquery-treetable/stylesheets/jquery.treetable.css') %>
<% stylesheet('deps/jquery-treetable/stylesheets/jquery.treetable.theme.default.css') %>

<% script('deps/codemirror/lib/codemirror.js') -%>
<% script('deps/codemirror/mode/clike/clike.js') -%>
<% script('deps/codemirror/addon/selection/active-line.js') -%>
<% stylesheet('deps/codemirror/lib/codemirror.css') -%>
<% stylesheet('deps/codemirror/theme/lesser-dark.css') -%>

<!-- ****************** STACK ANALYSER *************** -->
<div class="container-fluid">
	<div class="row">
		<div class="col-sm-5 col-md-4 col-lg-3 sidebar">
			<!-- Selection -->
			<div id='matt-func-list-selector'>
			</div>
			
		
			<!-- Func lis -->
			<ul class="nav nav-sidebar" id='matt-func-list'>
			</ul>
		</div>
		
		<!-- Source editor -->
		<div class="col-sm-7 col-md-8 col-lg-9 main">
			<div id='matt-source-editor'></div>
			<div id='matt-alloc-info' style="width:30%;float:left;"></div>
			<div id='matt-alloc-stacks' style="width:70%;float:left;">
				<table id='matt-alloc-stacks-tree'>
					<thead>
						<tr>
							<th>Function</th>
							<th>Metric</th>
						</tr>
					</thead>
					<tbody>
						<!--<tr class="branch expanded" data-tt-id="000">
          <td><span style="padding-left: 0px;" class="indenter"></span>app</td>
        </tr>
        <tr class="branch expanded" data-tt-id="100" data-tt-parent-id="000">
          <td><span style="padding-left: 19px;" class="indenter"></span>controllers</td>
        </tr>
        <tr class="leaf expanded" data-tt-id="500" data-tt-parent-id="100">
          <td><span style="padding-left: 38px;" class="indenter"></span>application_controller.rb</td>
        </tr>
        <tr class="leaf expanded" data-tt-id="200" data-tt-parent-id="000">
          <td><span style="padding-left: 19px;" class="indenter"></span>helpers</td>
        </tr>
        <tr class="leaf expanded" data-tt-id="300" data-tt-parent-id="000">
          <td><span style="padding-left: 19px;" class="indenter"></span>models</td>
        </tr>
        <tr class="leaf expanded" data-tt-id="400" data-tt-parent-id="000">
          <td><span style="padding-left: 19px;" class="indenter"></span>views</td>
        </tr>-->
					</tbody>
				</table>
			</div>
		</div>
	</div>
</div>

<script type='text/javascript'>
	$( document ).ready(function() {
		var mattEditor = new MattEditor('matt-source-editor');
		var mattFuncList = new MattFuncList('matt-func-list');
		var mattFuncListSelector = new MattFuncListSelector('matt-func-list-selector');
		mattFuncListSelector.onChange = function(){
			mattFuncList.updateOptions(this);
			mattEditor.setConfig(mattFuncListSelector.getSelector(),mattFuncListSelector.mode);
			mattEditor.redrawAnnotations();
		};
		mattFuncList.onClick = function(func,file,line)
		{
			mattEditor.setConfig(mattFuncListSelector.getSelector(),mattFuncListSelector.mode);
			mattEditor.updateFile(file,line,true);
		}
		mattFuncList.updateOptions(mattFuncListSelector);
	});
</script>
